Status: CANON
Owner: Architect
Last updated: 2026-01-28

# Webinars — Canonical Permissions & Roles

## Назначение
Зафиксировать канонические роли Webinars и допустимые действия по ролям в каждом состоянии жизненного цикла. Документ не описывает UI или реализацию и опирается на каноническую модель состояний, события и публичные контракты.

## Источники и приоритет
- Модель состояний: [CANON/STATE_MODEL](STATE_MODEL.md)
- Карта событий и инициаторов: [CANON/EVENT_HOOK_MAP](EVENT_HOOK_MAP.md)
- Публичные контракты: [CANON/PUBLIC_CONTRACTS](PUBLIC_CONTRACTS.md)

## Канонические роли
| Роль | Краткое назначение | Примечание |
| --- | --- | --- |
| `organizer` | Владелец/админ вебинара, управляет настройками и расписанием. | Работает через Core и публичные hooks. |
| `speaker` | Спикер, запускает/останавливает эфир, управляет CTA. | Действует через UI → публичные hooks. |
| `moderator` | Модератор взаимодействий (чат/QA/реакции). | Не меняет статус вебинара. |
| `attendee` | Зарегистрированный участник. | Источник клиентских событий (entered/completed). |
| `guest` | Незарегистрированный пользователь. | Только публичные страницы и регистрация. |
| `system` | Внутренние действия Core/runtime. | Единственный источник внутренних состояний/исключений. |

## Принципы доступа
- Изменение статуса вебинара возможно **только** через `core_webinar_set_status` со значениями `start`/`stop`. Любые иные попытки считаются запрещёнными. 
- Управление видимостью CTA возможно **только** через `core_webinar_set_cta_visibility`.
- Внутренние состояния (`paused`, `archived`) контролируются **только** ролью `system`.

---

## Матрица разрешений по состояниям
Формат: для каждой роли указаны действия **МОЖНО** и **ЗАПРЕЩЕНО**.

### `draft`
| Роль | МОЖНО | ЗАПРЕЩЕНО |
| --- | --- | --- |
| `organizer` | Создавать/редактировать черновик, назначать роли, задавать расписание и тип вебинара, готовить публичный слот. | Публиковать регистрацию, стартовать/останавливать эфир, менять статус напрямую. |
| `speaker` | Вносить содержательные материалы черновика (описание/контент), просматривать настройки. | Планировать слот, публиковать регистрацию, стартовать/останавливать эфир, менять статус напрямую. |
| `moderator` | Просмотр черновика и подготовка сценариев модерации. | Любые изменения статуса или слота. |
| `attendee` | Нет доступа (черновик не публичный). | Регистрация/вход/участие. |
| `guest` | Нет доступа (черновик не публичный). | Регистрация/вход/участие. |
| `system` | Внутренние проверки валидности, подготовка к публикации слота. | Запуск эфира без `scheduled`. |

### `scheduled`
| Роль | МОЖНО | ЗАПРЕЩЕНО |
| --- | --- | --- |
| `organizer` | Редактировать расписание и настройки, управлять регистрацией, инициировать старт/стоп через `core_webinar_set_status`. | Менять статус напрямую, архивировать. |
| `speaker` | Готовить контент/сценарий, инициировать старт/стоп через `core_webinar_set_status`, управлять CTA через `core_webinar_set_cta_visibility`. | Менять статус напрямую, архивировать. |
| `moderator` | Подготовка модерации, просмотр списка участников. | Старт/стоп, изменение статуса/CTA напрямую. |
| `attendee` | Регистрироваться, просматривать публичную страницу, получать подтверждение слота. | Вход в live‑комнату до старта, изменение статуса. |
| `guest` | Просмотр публичной страницы, регистрация. | Вход в live‑комнату без регистрации, изменение статуса. |
| `system` | Внутренние проверки доступности слота. | Прямое изменение статуса без `core_webinar_set_status`. |

### `live`
| Роль | МОЖНО | ЗАПРЕЩЕНО |
| --- | --- | --- |
| `organizer` | Мониторинг эфира, инициировать стоп через `core_webinar_set_status`, управлять CTA через `core_webinar_set_cta_visibility`. | Откат в `scheduled`, прямое изменение статуса. |
| `speaker` | Вести эфир, инициировать стоп через `core_webinar_set_status`, управлять CTA через `core_webinar_set_cta_visibility`. | Откат в `scheduled`, прямое изменение статуса. |
| `moderator` | Модерация чата/вопросов, удаление сообщений, управление участниками в рамках комнаты. | Старт/стоп, управление статусом/CTA напрямую. |
| `attendee` | Вход в комнату, участие в эфире, реакции/чат/вопросы, корректный выход. | Самостоятельно завершать вебинар, изменять статус, входить после завершения. |
| `guest` | Нет доступа без регистрации. | Вход в комнату, изменение статуса. |
| `system` | Техническая пауза/возобновление, сбор клиентских событий (entered/left/completed). | Изменять статус вне канонического перехода. |

### `paused`
| Роль | МОЖНО | ЗАПРЕЩЕНО |
| --- | --- | --- |
| `organizer` | Мониторинг паузы, инициировать стоп через `core_webinar_set_status`. | Возобновлять/ставить на паузу напрямую, менять статус напрямую. |
| `speaker` | Ожидание возобновления, инициировать стоп через `core_webinar_set_status`. | Возобновлять/ставить на паузу напрямую, менять статус напрямую. |
| `moderator` | Поддерживать порядок в комнате (если доступна). | Менять статус, завершать участие клиентов как completed. |
| `attendee` | Оставаться в комнате/ожидании, получать уведомления о возобновлении. | Завершать участие как completed до `live`/`finished`, инициировать стоп. |
| `guest` | Нет доступа без регистрации. | Вход/изменение статуса. |
| `system` | Единственный, кто может ставить на паузу и возобновлять `live`. | Завершать участие клиентов как completed без `stop`. |

### `finished`
| Роль | МОЖНО | ЗАПРЕЩЕНО |
| --- | --- | --- |
| `organizer` | Просмотр итогов, запуск post‑webinar сценариев, подготовка архивации. | Возобновлять эфир, открывать новые входы, менять статус напрямую. |
| `speaker` | Просмотр итогов, post‑webinar активности (формы/опросы). | Возобновлять эфир, открывать новые входы, менять статус напрямую. |
| `moderator` | Работа с пост‑вебинарными вопросами/чатом (если доступно). | Возобновлять эфир, открывать новые входы, менять статус напрямую. |
| `attendee` | Завершить участие (client_webinar_completed), отправить post‑webinar форму. | Вход в live‑комнату, изменение статуса. |
| `guest` | Просмотр публичных итогов/описания (если опубликовано). | Вход в live‑комнату, изменение статуса. |
| `system` | Инициировать архивацию, выпуск post‑webinar событий. | Открывать новые входы в live‑комнату. |

### `archived`
| Роль | МОЖНО | ЗАПРЕЩЕНО |
| --- | --- | --- |
| `organizer` | Только чтение/аналитика. | Любые изменения статуса, расписания или доступа. |
| `speaker` | Только чтение/аналитика. | Любые изменения статуса, расписания или доступа. |
| `moderator` | Только чтение/аналитика. | Любые изменения статуса, расписания или доступа. |
| `attendee` | Только чтение/архивные материалы (если опубликованы). | Любые изменения или вход в live‑комнату. |
| `guest` | Только чтение/архивные материалы (если опубликованы). | Любые изменения или вход в live‑комнату. |
| `system` | Обслуживание хранения/аналитики без изменения статуса. | Любые изменения статуса. |

---

## Эскалации и системные исключения (`system actions`)
- **Пауза/возобновление**: только роль `system` может переводить `live → paused → live`. Публичных hooks для этого нет.
- **Архивация**: только `system` переводит `finished → archived` после завершения и пост‑вебинарных процессов.
- **Сбор клиентских событий**: `system` фиксирует `client_webinar_entered/left/completed` и downstream‑нормализацию `webinar_completed`.
- **Ограничения безопасности**: любые попытки изменить статус/CTA напрямую отклоняются как нарушение публичного контракта.

Связанные документы:
- [CANON/STATE_MODEL](STATE_MODEL.md)
- [CANON/EVENT_HOOK_MAP](EVENT_HOOK_MAP.md)
- [CANON/PUBLIC_CONTRACTS](PUBLIC_CONTRACTS.md)
