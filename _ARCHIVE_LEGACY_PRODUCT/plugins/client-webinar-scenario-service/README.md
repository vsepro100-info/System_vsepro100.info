# Client Webinar Scenario Service (MVP)

## Назначение и границы
Плагин обрабатывает **только** канонические клиентские события вебинара и эмитит допустимые действия сценария для маршрута клиента. Реализация следует принципам независимости модулей и взаимодействия через hooks. UI, уведомления и партнёрская логика не входят в область ответственности.

## Область ответственности (scope)
- Подписка на события из канонического контракта клиентского вебинара.
- Проверка идемпотентности обработки событий.
- Генерация допустимых сценарных действий (маршрутизация и переходы между экранами).
- Эмиссия действий через hooks без прямых зависимостей.

## Не‑цели (non-goals)
- Любая UI‑логика или страницы админки.
- Любые уведомления (Telegram, email и т.п.).
- Любая временная логика, таймеры или cron.
- Партнёрская логика или продажи.
- Прямые зависимости от других плагинов.

## Поток обработки
1. Сервис слушает канонические события `webinar_*` и `post_webinar_form_submitted`.
2. Для каждого события строится набор допустимых действий сценария.
3. Действия эмитятся через hooks:
   - `client_webinar_scenario_action`
   - `client_webinar_scenario_action_{type}`
   - `client_webinar_scenario_actions_emitted`

## Идемпотентность
Идемпотентность обеспечивается transient‑маркером на основе хэша события и контекста. Повторная обработка одного и того же события не приводит к повторной эмиссии действий.

## Допустимые действия (MVP)
- `route_state` — маршрутизация лида в допустимое состояние сценария.
- `screen_transition` — переход в экранный ключ клиентского вебинарного потока.

## Соответствие архитектурным документам
| Код/раздел | Документ | Назначение |
| --- | --- | --- |
| Подписки на `webinar_*` и `post_webinar_form_submitted` | `CLIENT_WEBINAR_EVENTS.md` | Канонические входные события. |
| Построение действий `route_state` и `screen_transition` | `CLIENT_WEBINAR_SCENARIOS.md` | Допустимые действия сценария. |
| Идемпотентность, отсутствие таймеров и UI | `CLIENT_WEBINAR_SCENARIO_SERVICE.md` | Гарантии и границы сервиса. |
| Hooks‑взаимодействие (`do_action`) | `ARCHITECTURE.md` | Принцип взаимодействия через hooks. |
