# Канонические клиентские события вебинара

## Назначение
Этот документ фиксирует канонический контракт клиентских событий вебинара для сценариев. Он определяет имена событий, структуру полезной нагрузки верхнего уровня и правила эмиссии без привязки к реализации.

## Состояние реализации
- Реально реализовано в коде: `client_webinar_completed`, `client_webinar_entered`, `client_webinar_attendance_classified`.
- Запланировано / не реализовано: остальные события, перечисленные ниже.

## Канонические события (контракт)
Ниже перечислены единственные допустимые события клиентского вебинара. Любое событие без пометки «реально реализовано» считается запланированным и не реализованным.

### 1) `client_webinar_registered` (запланировано / не реализовано)
**Смысл:** клиент зарегистрирован на вебинар (live или auto).

**Payload (верхний уровень):**
- `lead_id` — идентификатор лида (канонический идентификатор клиента).
- `webinar_id` — идентификатор вебинара.
- `webinar_type` — тип вебинара (`live` | `auto`).
- `slot_id` — идентификатор слота (только для live, если применимо).
- `registered_at` — отметка времени регистрации (как факт регистрации, без расписаний).
- `source` — источник регистрации (страница/канал/контекст).

**Правила эмиссии:**
- Эмитируется клиентским вебинарным слоем при успешной регистрации клиента.
- Должно быть единичным фактом регистрации на выбранный вебинар.

---

### 2) `client_webinar_entered` (реально реализовано)
**Смысл:** клиент вошёл в вебинарный опыт (live или auto).

**Payload (верхний уровень):**
- `lead_id` — идентификатор лида (если доступен).
- `webinar_id` — идентификатор вебинара.
- `timestamp` — отметка времени входа (как факт входа).

**Правила эмиссии:**
- Эмитируется при фактическом входе клиента в вебинарный опыт.
- Эмитируется один раз на сессию участия.

---

### 3) `client_webinar_left` (запланировано / не реализовано)
**Смысл:** клиент покинул вебинарный опыт (live или auto).

**Payload (верхний уровень):**
- `lead_id` — идентификатор лида.
- `webinar_id` — идентификатор вебинара.
- `webinar_type` — тип вебинара (`live` | `auto`).
- `session_id` — идентификатор сессии участия.
- `left_at` — отметка времени выхода (как факт выхода).
- `leave_reason` — причина выхода (например: `user_exit`, `session_end`, `network_loss`).

**Правила эмиссии:**
- Эмитируется при фактическом выходе клиента из вебинарного опыта.
- Эмитируется один раз на сессию участия.

---

### 4) `client_webinar_completed` (реально реализовано)
**Смысл:** клиент завершил участие в вебинаре.

**Payload (верхний уровень):**
- `lead_id` — идентификатор лида.
- `webinar_id` — идентификатор вебинара.
- `webinar_type` — тип вебинара (`live` | `auto`).
- `session_id` — идентификатор сессии участия.
- `completed_at` — отметка времени завершения.

**Правила эмиссии:**
- Эмитируется, когда участие клиента считается завершённым по факту прохождения вебинара.
- Не заменяет событие выхода; может следовать после `client_webinar_left` при корректном завершении.

---

### 5) `client_webinar_form_submitted` (запланировано / не реализовано)
**Смысл:** клиент отправил пост‑вебинарную форму.

**Payload (верхний уровень):**
- `lead_id` — идентификатор лида.
- `webinar_id` — идентификатор вебинара.
- `webinar_type` — тип вебинара (`live` | `auto`).
- `session_id` — идентификатор сессии участия.
- `submitted_at` — отметка времени отправки.
- `form_id` — идентификатор формы.
- `form_payload` — агрегированные ответы (структура определяется формой).

**Правила эмиссии:**
- Эмитируется при успешной отправке клиентом пост‑вебинарной формы.
- Допускается повторная эмиссия при повторной отправке, если форма допускает повторное заполнение.

---

### 6) `client_webinar_attendance_classified` (реально реализовано)
**Смысл:** сервисная классификация факта посещения вебинара.

**Payload (верхний уровень):**
- `lead_id` — идентификатор лида.
- `webinar_id` — идентификатор вебинара.
- `attended` — флаг посещения (`true` | `false`).
- `timestamp` — отметка времени классификации.

**Правила эмиссии:**
- Эмитируется сервисным классификатором при завершении участия (`client_webinar_completed`) или при явной оценке.
- Если есть завершение участия → `attended = true`.
- Если есть вход и нет завершения участия → `attended = false`.
- Потребитель `post-webinar-routing-service` эмитирует `post_webinar_route` со статусом `attended` или `not_attended` и тем же payload.

## Общие гарантии и границы
- Канонические события предназначены для слоя сценариев клиентского вебинара и не несут партнёрской логики.
- Контракт фиксирует только факты поведения клиента и их минимальный контекст.
- Никаких временных сценариев, расписаний, таймеров или UI‑поведения здесь не определяется.
- Никаких партнёрских уведомлений или логики продаж не допускается.

## Явные исключения
- Любая реализация, код или обработчики.
- Любые тайминги сценариев и планирование событий.
- Любые описания экранов или UI‑логики.
- Любая партнёрская коммуникация или интеграции.
